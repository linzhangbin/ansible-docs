<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Variables &mdash; 国内最专业的Ansible中文官方学习手册</title><link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="条件选择" href="playbooks_conditionals.html" />
    <link rel="prev" title="Playbook 角色(Roles) 和 Include 语句" href="playbooks_roles.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Ansible中文权威指南
          </a>
              <div class="version">
                5.2.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="intro.html">总体介绍</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">快速学习视频</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="playbooks.html">Playbooks</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="playbooks_intro.html">Playbooks 介绍</a></li>
<li class="toctree-l2"><a class="reference internal" href="playbooks_roles.html">Playbook 角色(Roles) 和 Include 语句</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Variables</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#section-1">合法的变量名</a></li>
<li class="toctree-l3"><a class="reference internal" href="#inventory">在Inventory中定义变量</a></li>
<li class="toctree-l3"><a class="reference internal" href="#playbook">在playbook中定义变量</a></li>
<li class="toctree-l3"><a class="reference internal" href="#role">在文件和role中定义变量</a></li>
<li class="toctree-l3"><a class="reference internal" href="#jinja2">使用变量: 关于Jinja2</a></li>
<li class="toctree-l3"><a class="reference internal" href="#jinja2-1">Jinja2过滤器</a></li>
<li class="toctree-l3"><a class="reference internal" href="#yaml">YAML陷阱</a></li>
<li class="toctree-l3"><a class="reference internal" href="#facts">使用Facts获取的信息</a></li>
<li class="toctree-l3"><a class="reference internal" href="#facts-1">关闭Facts</a></li>
<li class="toctree-l3"><a class="reference internal" href="#facts-facts-d">本地Facts(Facts.d)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#fact">Fact缓存</a></li>
<li class="toctree-l3"><a class="reference internal" href="#section-2">注册变量</a></li>
<li class="toctree-l3"><a class="reference internal" href="#section-3">访问复杂变量数据</a></li>
<li class="toctree-l3"><a class="reference internal" href="#section-4">魔法变量,以及如何访问其它主机的信息</a></li>
<li class="toctree-l3"><a class="reference internal" href="#section-5">变量文件分割</a></li>
<li class="toctree-l3"><a class="reference internal" href="#section-6">命令行中传递变量</a></li>
<li class="toctree-l3"><a class="reference internal" href="#section-7">变量的优先级: 我该在什么地方放置变量?</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="playbooks_conditionals.html">条件选择</a></li>
<li class="toctree-l2"><a class="reference internal" href="playbooks_loops.html">循环</a></li>
<li class="toctree-l2"><a class="reference internal" href="playbooks_best_practices.html">最佳实践</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="playbooks_special_topics.html">Playbooks: Special Topics</a></li>
<li class="toctree-l1"><a class="reference internal" href="modules.html">模块相关</a></li>
<li class="toctree-l1"><a class="reference internal" href="guides.html">详细指南</a></li>
<li class="toctree-l1"><a class="reference internal" href="developing.html">开发者须知</a></li>
<li class="toctree-l1"><a class="reference internal" href="tower.html">Ansible Tower</a></li>
<li class="toctree-l1"><a class="reference internal" href="community.html">Ansible用户</a></li>
<li class="toctree-l1"><a class="reference internal" href="community.html#section-4">对当前和未来的开发人员</a></li>
<li class="toctree-l1"><a class="reference internal" href="community.html#section-5">其它主题</a></li>
<li class="toctree-l1"><a class="reference internal" href="galaxy.html">Ansible Galaxy</a></li>
<li class="toctree-l1"><a class="reference internal" href="test_strategies.html">测试策略</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">常见问题</a></li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">术语表</a></li>
<li class="toctree-l1"><a class="reference internal" href="YAMLSyntax.html">YAML 语法</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Ansible中文权威指南</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="playbooks.html">Playbooks</a></li>
      <li class="breadcrumb-item active">Variables</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/docs/playbooks_variables.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="variables">
<h1><a class="toc-backref" href="#toc-entry-1" role="doc-backlink">Variables</a><a class="headerlink" href="#variables" title="Permalink to this headline">¶</a></h1>
<nav class="contents" id="topics">
<p class="topic-title">Topics</p>
<ul class="simple">
<li><p><a class="reference internal" href="#variables" id="toc-entry-1">Variables</a></p>
<ul>
<li><p><a class="reference internal" href="#section-1" id="toc-entry-2">合法的变量名</a></p></li>
<li><p><a class="reference internal" href="#inventory" id="toc-entry-3">在Inventory中定义变量</a></p></li>
<li><p><a class="reference internal" href="#playbook" id="toc-entry-4">在playbook中定义变量</a></p></li>
<li><p><a class="reference internal" href="#role" id="toc-entry-5">在文件和role中定义变量</a></p></li>
<li><p><a class="reference internal" href="#jinja2" id="toc-entry-6">使用变量: 关于Jinja2</a></p></li>
<li><p><a class="reference internal" href="#jinja2-1" id="toc-entry-7">Jinja2过滤器</a></p></li>
<li><p><a class="reference internal" href="#yaml" id="toc-entry-8">YAML陷阱</a></p></li>
<li><p><a class="reference internal" href="#facts" id="toc-entry-9">使用Facts获取的信息</a></p></li>
<li><p><a class="reference internal" href="#facts-1" id="toc-entry-10">关闭Facts</a></p></li>
<li><p><a class="reference internal" href="#facts-facts-d" id="toc-entry-11">本地Facts(Facts.d)</a></p></li>
<li><p><a class="reference internal" href="#fact" id="toc-entry-12">Fact缓存</a></p></li>
<li><p><a class="reference internal" href="#section-2" id="toc-entry-13">注册变量</a></p></li>
<li><p><a class="reference internal" href="#section-3" id="toc-entry-14">访问复杂变量数据</a></p></li>
<li><p><a class="reference internal" href="#section-4" id="toc-entry-15">魔法变量,以及如何访问其它主机的信息</a></p></li>
<li><p><a class="reference internal" href="#section-5" id="toc-entry-16">变量文件分割</a></p></li>
<li><p><a class="reference internal" href="#section-6" id="toc-entry-17">命令行中传递变量</a></p></li>
<li><p><a class="reference internal" href="#section-7" id="toc-entry-18">变量的优先级: 我该在什么地方放置变量?</a></p></li>
</ul>
</li>
</ul>
</nav>
<p>已经存在的自动化技术使得重复做事变得更加容易,但你的所有系统有时则不会这样.
在有些系统中你想设置一些行为或者配置,这与其它系统稍有不同.</p>
<p>并且,远程系统的可视行为或状态会影响我们配置这些系统.（比如你需要得到一个系统的IP地址,甚至用该值来配置另一个系统）.</p>
<p>你可能有一些非常相似的模板或配置文件,而有些变量则稍微不同.
Ansible中的变量用来处理系统间的不同.</p>
<p>为了理解变量,你也需要深入阅读 <a class="reference internal" href="playbooks_conditionals.html"><span class="doc">条件选择</span></a> 和 <a class="reference internal" href="playbooks_loops.html"><span class="doc">循环</span></a>.有用的模块(比如”group_by”模块和”when”条件)也可以结合变量使用,用于管理系统间的不同之处.</p>
<p>强烈建议你学习 ansible-examples github代码库,里面有大量使用变量的例子.</p>
<section id="section-1">
<span id="valid-variable-names"></span><h2><a class="toc-backref" href="#toc-entry-2" role="doc-backlink">合法的变量名</a><a class="headerlink" href="#section-1" title="Permalink to this headline">¶</a></h2>
<p>在使用变量之前最好先知道什么是合法的变量名.
变量名可以为字母,数字以及下划线.变量始终应该以字母开头.
“foo_port”是个合法的变量名.”foo5”也是.
“foo-port”, “foo port”, “foo.port” 和 “12”则不是合法的变量名.</p>
<p>很简单吧,继续往下看.</p>
</section>
<section id="inventory">
<span id="variables-in-inventory"></span><h2><a class="toc-backref" href="#toc-entry-3" role="doc-backlink">在Inventory中定义变量</a><a class="headerlink" href="#inventory" title="Permalink to this headline">¶</a></h2>
<p>我们已经在其它文档中覆盖了大量关于使用变量的场景,所以这里没多少新的知识点,权当加深记忆.</p>
<p>通常你想基于一个机器位于哪个群组而设置变量.比如,位于波士顿的很多机器会使用 ‘boston.ntp.example.com’ 作为NTP服务器.</p>
<p>请看 <a class="reference internal" href="intro_inventory.html"><span class="doc">Inventory文件</span></a> 文档来学习在inventory中使用多种方式来定义变量.</p>
</section>
<section id="playbook">
<span id="playbook-variables"></span><h2><a class="toc-backref" href="#toc-entry-4" role="doc-backlink">在playbook中定义变量</a><a class="headerlink" href="#playbook" title="Permalink to this headline">¶</a></h2>
<p>在playbook中,可以直接定义变量,如下所示:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span> <span class="n">hosts</span><span class="p">:</span> <span class="n">webservers</span>
  <span class="nb">vars</span><span class="p">:</span>
    <span class="n">http_port</span><span class="p">:</span> <span class="mi">80</span>
</pre></div>
</div>
<p>这种所见即所得的方式非常好.</p>
</section>
<section id="role">
<span id="included-variables"></span><h2><a class="toc-backref" href="#toc-entry-5" role="doc-backlink">在文件和role中定义变量</a><a class="headerlink" href="#role" title="Permalink to this headline">¶</a></h2>
<p>事实上在其它地方我们也讲过这点了.
正如在 <a class="reference internal" href="playbooks_roles.html"><span class="doc">Playbook 角色(Roles) 和 Include 语句</span></a> 描述的一样,变量也可以通过文件包含在playbook中,该变量可以作为或者不作为“Ansible Role”的一部分.使用role是首选,因为它提供了一个很好的组织体系.</p>
</section>
<section id="jinja2">
<span id="about-jinja2"></span><h2><a class="toc-backref" href="#toc-entry-6" role="doc-backlink">使用变量: 关于Jinja2</a><a class="headerlink" href="#jinja2" title="Permalink to this headline">¶</a></h2>
<p>我们已经知道很多关于定义变量的知识,那么你知道如何使用它们吗？</p>
<p>Ansible允许你使用Jinja2模板系统在playbook中引用变量.借助Jinja你能做很多复杂的操作,首先你要学习基本使用.
例如,在简单的模板中你可以这样做:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">My</span> <span class="n">amp</span> <span class="n">goes</span> <span class="n">to</span> <span class="p">{{</span> <span class="n">max_amp_value</span> <span class="p">}}</span>
</pre></div>
</div>
<p>这就是变量替换最基本的形式.
你也可以在playbook中直接这样用,你偶尔想这样做:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">template</span><span class="p">:</span> <span class="n">src</span><span class="o">=</span><span class="n">foo</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">j2</span> <span class="n">dest</span><span class="o">=</span><span class="p">{{</span> <span class="n">remote_install_path</span> <span class="p">}}</span><span class="o">/</span><span class="n">foo</span><span class="o">.</span><span class="n">cfg</span>
</pre></div>
</div>
<p>In the above example, we used a variable to help decide where to place a file.
在上述的例子中,我们使用变量来决定文件放置在哪里.
在模板中你自动会获取在主机范围之内的所有变量的访问权.事实上更多,你可以读取其它主机的变量.我们将演示如何做.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>在模板中Jinja2可以用循环和条件语句,而在playbook中则不行.Ansible playbook是纯粹的机器解析的YAML.这是一个非常重要的功能,这意味着根据文件可以生成代码,或者其它系统工具能够读取Ansible文件.虽然并不是所有人都需要这个功能,但我们不能封锁可能性.</p>
</aside>
</section>
<section id="jinja2-1">
<span id="jinja2-filters"></span><h2><a class="toc-backref" href="#toc-entry-7" role="doc-backlink">Jinja2过滤器</a><a class="headerlink" href="#jinja2-1" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>这并不是常用的特性.只在合适的时候使用它们,这是一个附加知识点.</p>
</aside>
<p>Jinja2中的过滤器可以把一个模板表达式转换为另一个.Jinja2附带了很多这样的功能.请参见Jinja2官方模板文档中的 <a class="reference external" href="http://jinja.pocoo.org/docs/templates/#builtin-filters">builtin filters</a>.</p>
<p>另外,Ansible还支持其它特性.请看 <span class="xref std std-doc">playbooks_filters</span> 文档中关于一系列可用的过滤器及示例.</p>
</section>
<section id="yaml">
<span id="yaml-gotchas"></span><h2><a class="toc-backref" href="#toc-entry-8" role="doc-backlink">YAML陷阱</a><a class="headerlink" href="#yaml" title="Permalink to this headline">¶</a></h2>
<p>YAML语法要求如果值以{{ foo }}开头的话我们需要将整行用双引号包起来.这是为了确认你不是想声明一个YAML字典.该知识点在 <a class="reference internal" href="YAMLSyntax.html"><span class="doc">YAML 语法</span></a> 页面有所讲述.</p>
<p>这样是不行的:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span> <span class="n">hosts</span><span class="p">:</span> <span class="n">app_servers</span>
  <span class="nb">vars</span><span class="p">:</span>
      <span class="n">app_path</span><span class="p">:</span> <span class="p">{{</span> <span class="n">base_path</span> <span class="p">}}</span><span class="o">/</span><span class="mi">22</span>
</pre></div>
</div>
<p>你应该这么做:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span> <span class="n">hosts</span><span class="p">:</span> <span class="n">app_servers</span>
  <span class="nb">vars</span><span class="p">:</span>
       <span class="n">app_path</span><span class="p">:</span> <span class="s2">&quot;{{ base_path }}/22&quot;</span>
</pre></div>
</div>
</section>
<section id="facts">
<span id="vars-and-facts"></span><h2><a class="toc-backref" href="#toc-entry-9" role="doc-backlink">使用Facts获取的信息</a><a class="headerlink" href="#facts" title="Permalink to this headline">¶</a></h2>
<p>还有其它地方可以获取变量,这些变量是自动发现的,而不是用户自己设置的.</p>
<p>Facts通过访问远程系统获取相应的信息.
一个例子就是远程主机的IP地址或者操作系统是什么.
使用以下命令可以查看哪些信息是可用的:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ansible</span> <span class="n">hostname</span> <span class="o">-</span><span class="n">m</span> <span class="n">setup</span>
</pre></div>
</div>
<p>这会返回巨量的变量数据,比如对于Ubutu 12.04系统,Ansible 1.4获取的信息显示如下:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;ansible_all_ipv4_addresses&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="s2">&quot;REDACTED IP ADDRESS&quot;</span>
<span class="p">],</span>
<span class="s2">&quot;ansible_all_ipv6_addresses&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="s2">&quot;REDACTED IPV6 ADDRESS&quot;</span>
<span class="p">],</span>
<span class="s2">&quot;ansible_architecture&quot;</span><span class="p">:</span> <span class="s2">&quot;x86_64&quot;</span><span class="p">,</span>
<span class="s2">&quot;ansible_bios_date&quot;</span><span class="p">:</span> <span class="s2">&quot;09/20/2012&quot;</span><span class="p">,</span>
<span class="s2">&quot;ansible_bios_version&quot;</span><span class="p">:</span> <span class="s2">&quot;6.00&quot;</span><span class="p">,</span>
<span class="s2">&quot;ansible_cmdline&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;BOOT_IMAGE&quot;</span><span class="p">:</span> <span class="s2">&quot;/boot/vmlinuz-3.5.0-23-generic&quot;</span><span class="p">,</span>
    <span class="s2">&quot;quiet&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>
    <span class="s2">&quot;ro&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>
    <span class="s2">&quot;root&quot;</span><span class="p">:</span> <span class="s2">&quot;UUID=4195bff4-e157-4e41-8701-e93f0aec9e22&quot;</span><span class="p">,</span>
    <span class="s2">&quot;splash&quot;</span><span class="p">:</span> <span class="n">true</span>
<span class="p">},</span>
<span class="s2">&quot;ansible_date_time&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="s2">&quot;2013-10-02&quot;</span><span class="p">,</span>
    <span class="s2">&quot;day&quot;</span><span class="p">:</span> <span class="s2">&quot;02&quot;</span><span class="p">,</span>
    <span class="s2">&quot;epoch&quot;</span><span class="p">:</span> <span class="s2">&quot;1380756810&quot;</span><span class="p">,</span>
    <span class="s2">&quot;hour&quot;</span><span class="p">:</span> <span class="s2">&quot;19&quot;</span><span class="p">,</span>
    <span class="s2">&quot;iso8601&quot;</span><span class="p">:</span> <span class="s2">&quot;2013-10-02T23:33:30Z&quot;</span><span class="p">,</span>
    <span class="s2">&quot;iso8601_micro&quot;</span><span class="p">:</span> <span class="s2">&quot;2013-10-02T23:33:30.036070Z&quot;</span><span class="p">,</span>
    <span class="s2">&quot;minute&quot;</span><span class="p">:</span> <span class="s2">&quot;33&quot;</span><span class="p">,</span>
    <span class="s2">&quot;month&quot;</span><span class="p">:</span> <span class="s2">&quot;10&quot;</span><span class="p">,</span>
    <span class="s2">&quot;second&quot;</span><span class="p">:</span> <span class="s2">&quot;30&quot;</span><span class="p">,</span>
    <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="s2">&quot;19:33:30&quot;</span><span class="p">,</span>
    <span class="s2">&quot;tz&quot;</span><span class="p">:</span> <span class="s2">&quot;EDT&quot;</span><span class="p">,</span>
    <span class="s2">&quot;year&quot;</span><span class="p">:</span> <span class="s2">&quot;2013&quot;</span>
<span class="p">},</span>
<span class="s2">&quot;ansible_default_ipv4&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;address&quot;</span><span class="p">:</span> <span class="s2">&quot;REDACTED&quot;</span><span class="p">,</span>
    <span class="s2">&quot;alias&quot;</span><span class="p">:</span> <span class="s2">&quot;eth0&quot;</span><span class="p">,</span>
    <span class="s2">&quot;gateway&quot;</span><span class="p">:</span> <span class="s2">&quot;REDACTED&quot;</span><span class="p">,</span>
    <span class="s2">&quot;interface&quot;</span><span class="p">:</span> <span class="s2">&quot;eth0&quot;</span><span class="p">,</span>
    <span class="s2">&quot;macaddress&quot;</span><span class="p">:</span> <span class="s2">&quot;REDACTED&quot;</span><span class="p">,</span>
    <span class="s2">&quot;mtu&quot;</span><span class="p">:</span> <span class="mi">1500</span><span class="p">,</span>
    <span class="s2">&quot;netmask&quot;</span><span class="p">:</span> <span class="s2">&quot;255.255.255.0&quot;</span><span class="p">,</span>
    <span class="s2">&quot;network&quot;</span><span class="p">:</span> <span class="s2">&quot;REDACTED&quot;</span><span class="p">,</span>
    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ether&quot;</span>
<span class="p">},</span>
<span class="s2">&quot;ansible_default_ipv6&quot;</span><span class="p">:</span> <span class="p">{},</span>
<span class="s2">&quot;ansible_devices&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;fd0&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;holders&quot;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s2">&quot;host&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span>
        <span class="s2">&quot;partitions&quot;</span><span class="p">:</span> <span class="p">{},</span>
        <span class="s2">&quot;removable&quot;</span><span class="p">:</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span>
        <span class="s2">&quot;rotational&quot;</span><span class="p">:</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span>
        <span class="s2">&quot;scheduler_mode&quot;</span><span class="p">:</span> <span class="s2">&quot;deadline&quot;</span><span class="p">,</span>
        <span class="s2">&quot;sectors&quot;</span><span class="p">:</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span>
        <span class="s2">&quot;sectorsize&quot;</span><span class="p">:</span> <span class="s2">&quot;512&quot;</span><span class="p">,</span>
        <span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="s2">&quot;0.00 Bytes&quot;</span><span class="p">,</span>
        <span class="s2">&quot;support_discard&quot;</span><span class="p">:</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span>
        <span class="s2">&quot;vendor&quot;</span><span class="p">:</span> <span class="n">null</span>
    <span class="p">},</span>
    <span class="s2">&quot;sda&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;holders&quot;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s2">&quot;host&quot;</span><span class="p">:</span> <span class="s2">&quot;SCSI storage controller: LSI Logic / Symbios Logic 53c1030 PCI-X Fusion-MPT Dual Ultra320 SCSI (rev 01)&quot;</span><span class="p">,</span>
        <span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="s2">&quot;VMware Virtual S&quot;</span><span class="p">,</span>
        <span class="s2">&quot;partitions&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;sda1&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;sectors&quot;</span><span class="p">:</span> <span class="s2">&quot;39843840&quot;</span><span class="p">,</span>
                <span class="s2">&quot;sectorsize&quot;</span><span class="p">:</span> <span class="mi">512</span><span class="p">,</span>
                <span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="s2">&quot;19.00 GB&quot;</span><span class="p">,</span>
                <span class="s2">&quot;start&quot;</span><span class="p">:</span> <span class="s2">&quot;2048&quot;</span>
            <span class="p">},</span>
            <span class="s2">&quot;sda2&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;sectors&quot;</span><span class="p">:</span> <span class="s2">&quot;2&quot;</span><span class="p">,</span>
                <span class="s2">&quot;sectorsize&quot;</span><span class="p">:</span> <span class="mi">512</span><span class="p">,</span>
                <span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="s2">&quot;1.00 KB&quot;</span><span class="p">,</span>
                <span class="s2">&quot;start&quot;</span><span class="p">:</span> <span class="s2">&quot;39847934&quot;</span>
            <span class="p">},</span>
            <span class="s2">&quot;sda5&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;sectors&quot;</span><span class="p">:</span> <span class="s2">&quot;2093056&quot;</span><span class="p">,</span>
                <span class="s2">&quot;sectorsize&quot;</span><span class="p">:</span> <span class="mi">512</span><span class="p">,</span>
                <span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="s2">&quot;1022.00 MB&quot;</span><span class="p">,</span>
                <span class="s2">&quot;start&quot;</span><span class="p">:</span> <span class="s2">&quot;39847936&quot;</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="s2">&quot;removable&quot;</span><span class="p">:</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span>
        <span class="s2">&quot;rotational&quot;</span><span class="p">:</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span>
        <span class="s2">&quot;scheduler_mode&quot;</span><span class="p">:</span> <span class="s2">&quot;deadline&quot;</span><span class="p">,</span>
        <span class="s2">&quot;sectors&quot;</span><span class="p">:</span> <span class="s2">&quot;41943040&quot;</span><span class="p">,</span>
        <span class="s2">&quot;sectorsize&quot;</span><span class="p">:</span> <span class="s2">&quot;512&quot;</span><span class="p">,</span>
        <span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="s2">&quot;20.00 GB&quot;</span><span class="p">,</span>
        <span class="s2">&quot;support_discard&quot;</span><span class="p">:</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span>
        <span class="s2">&quot;vendor&quot;</span><span class="p">:</span> <span class="s2">&quot;VMware,&quot;</span>
    <span class="p">},</span>
    <span class="s2">&quot;sr0&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;holders&quot;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s2">&quot;host&quot;</span><span class="p">:</span> <span class="s2">&quot;IDE interface: Intel Corporation 82371AB/EB/MB PIIX4 IDE (rev 01)&quot;</span><span class="p">,</span>
        <span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="s2">&quot;VMware IDE CDR10&quot;</span><span class="p">,</span>
        <span class="s2">&quot;partitions&quot;</span><span class="p">:</span> <span class="p">{},</span>
        <span class="s2">&quot;removable&quot;</span><span class="p">:</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span>
        <span class="s2">&quot;rotational&quot;</span><span class="p">:</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span>
        <span class="s2">&quot;scheduler_mode&quot;</span><span class="p">:</span> <span class="s2">&quot;deadline&quot;</span><span class="p">,</span>
        <span class="s2">&quot;sectors&quot;</span><span class="p">:</span> <span class="s2">&quot;2097151&quot;</span><span class="p">,</span>
        <span class="s2">&quot;sectorsize&quot;</span><span class="p">:</span> <span class="s2">&quot;512&quot;</span><span class="p">,</span>
        <span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="s2">&quot;1024.00 MB&quot;</span><span class="p">,</span>
        <span class="s2">&quot;support_discard&quot;</span><span class="p">:</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span>
        <span class="s2">&quot;vendor&quot;</span><span class="p">:</span> <span class="s2">&quot;NECVMWar&quot;</span>
    <span class="p">}</span>
<span class="p">},</span>
<span class="s2">&quot;ansible_distribution&quot;</span><span class="p">:</span> <span class="s2">&quot;Ubuntu&quot;</span><span class="p">,</span>
<span class="s2">&quot;ansible_distribution_release&quot;</span><span class="p">:</span> <span class="s2">&quot;precise&quot;</span><span class="p">,</span>
<span class="s2">&quot;ansible_distribution_version&quot;</span><span class="p">:</span> <span class="s2">&quot;12.04&quot;</span><span class="p">,</span>
<span class="s2">&quot;ansible_domain&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="s2">&quot;ansible_env&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;COLORTERM&quot;</span><span class="p">:</span> <span class="s2">&quot;gnome-terminal&quot;</span><span class="p">,</span>
    <span class="s2">&quot;DISPLAY&quot;</span><span class="p">:</span> <span class="s2">&quot;:0&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HOME&quot;</span><span class="p">:</span> <span class="s2">&quot;/home/mdehaan&quot;</span><span class="p">,</span>
    <span class="s2">&quot;LANG&quot;</span><span class="p">:</span> <span class="s2">&quot;C&quot;</span><span class="p">,</span>
    <span class="s2">&quot;LESSCLOSE&quot;</span><span class="p">:</span> <span class="s2">&quot;/usr/bin/lesspipe </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="s2">&quot;LESSOPEN&quot;</span><span class="p">:</span> <span class="s2">&quot;| /usr/bin/lesspipe </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="s2">&quot;LOGNAME&quot;</span><span class="p">:</span> <span class="s2">&quot;root&quot;</span><span class="p">,</span>
    <span class="s2">&quot;LS_COLORS&quot;</span><span class="p">:</span> <span class="s2">&quot;rs=0:di=01;34:ln=01;36:mh=00:pi=40;33:so=01;35:do=01;35:bd=40;33;01:cd=40;33;01:or=40;31;01:su=37;41:sg=30;43:ca=30;41:tw=30;42:ow=34;42:st=37;44:ex=01;32:*.tar=01;31:*.tgz=01;31:*.arj=01;31:*.taz=01;31:*.lzh=01;31:*.lzma=01;31:*.tlz=01;31:*.txz=01;31:*.zip=01;31:*.z=01;31:*.Z=01;31:*.dz=01;31:*.gz=01;31:*.lz=01;31:*.xz=01;31:*.bz2=01;31:*.bz=01;31:*.tbz=01;31:*.tbz2=01;31:*.tz=01;31:*.deb=01;31:*.rpm=01;31:*.jar=01;31:*.war=01;31:*.ear=01;31:*.sar=01;31:*.rar=01;31:*.ace=01;31:*.zoo=01;31:*.cpio=01;31:*.7z=01;31:*.rz=01;31:*.jpg=01;35:*.jpeg=01;35:*.gif=01;35:*.bmp=01;35:*.pbm=01;35:*.pgm=01;35:*.ppm=01;35:*.tga=01;35:*.xbm=01;35:*.xpm=01;35:*.tif=01;35:*.tiff=01;35:*.png=01;35:*.svg=01;35:*.svgz=01;35:*.mng=01;35:*.pcx=01;35:*.mov=01;35:*.mpg=01;35:*.mpeg=01;35:*.m2v=01;35:*.mkv=01;35:*.webm=01;35:*.ogm=01;35:*.mp4=01;35:*.m4v=01;35:*.mp4v=01;35:*.vob=01;35:*.qt=01;35:*.nuv=01;35:*.wmv=01;35:*.asf=01;35:*.rm=01;35:*.rmvb=01;35:*.flc=01;35:*.avi=01;35:*.fli=01;35:*.flv=01;35:*.gl=01;35:*.dl=01;35:*.xcf=01;35:*.xwd=01;35:*.yuv=01;35:*.cgm=01;35:*.emf=01;35:*.axv=01;35:*.anx=01;35:*.ogv=01;35:*.ogx=01;35:*.aac=00;36:*.au=00;36:*.flac=00;36:*.mid=00;36:*.midi=00;36:*.mka=00;36:*.mp3=00;36:*.mpc=00;36:*.ogg=00;36:*.ra=00;36:*.wav=00;36:*.axa=00;36:*.oga=00;36:*.spx=00;36:*.xspf=00;36:&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MAIL&quot;</span><span class="p">:</span> <span class="s2">&quot;/var/mail/root&quot;</span><span class="p">,</span>
    <span class="s2">&quot;OLDPWD&quot;</span><span class="p">:</span> <span class="s2">&quot;/root/ansible/docsite&quot;</span><span class="p">,</span>
    <span class="s2">&quot;PATH&quot;</span><span class="p">:</span> <span class="s2">&quot;/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;</span><span class="p">,</span>
    <span class="s2">&quot;PWD&quot;</span><span class="p">:</span> <span class="s2">&quot;/root/ansible&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SHELL&quot;</span><span class="p">:</span> <span class="s2">&quot;/bin/bash&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SHLVL&quot;</span><span class="p">:</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SUDO_COMMAND&quot;</span><span class="p">:</span> <span class="s2">&quot;/bin/bash&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SUDO_GID&quot;</span><span class="p">:</span> <span class="s2">&quot;1000&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SUDO_UID&quot;</span><span class="p">:</span> <span class="s2">&quot;1000&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SUDO_USER&quot;</span><span class="p">:</span> <span class="s2">&quot;mdehaan&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TERM&quot;</span><span class="p">:</span> <span class="s2">&quot;xterm&quot;</span><span class="p">,</span>
    <span class="s2">&quot;USER&quot;</span><span class="p">:</span> <span class="s2">&quot;root&quot;</span><span class="p">,</span>
    <span class="s2">&quot;USERNAME&quot;</span><span class="p">:</span> <span class="s2">&quot;root&quot;</span><span class="p">,</span>
    <span class="s2">&quot;XAUTHORITY&quot;</span><span class="p">:</span> <span class="s2">&quot;/home/mdehaan/.Xauthority&quot;</span><span class="p">,</span>
    <span class="s2">&quot;_&quot;</span><span class="p">:</span> <span class="s2">&quot;/usr/local/bin/ansible&quot;</span>
<span class="p">},</span>
<span class="s2">&quot;ansible_eth0&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;active&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>
    <span class="s2">&quot;device&quot;</span><span class="p">:</span> <span class="s2">&quot;eth0&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ipv4&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;address&quot;</span><span class="p">:</span> <span class="s2">&quot;REDACTED&quot;</span><span class="p">,</span>
        <span class="s2">&quot;netmask&quot;</span><span class="p">:</span> <span class="s2">&quot;255.255.255.0&quot;</span><span class="p">,</span>
        <span class="s2">&quot;network&quot;</span><span class="p">:</span> <span class="s2">&quot;REDACTED&quot;</span>
    <span class="p">},</span>
    <span class="s2">&quot;ipv6&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;address&quot;</span><span class="p">:</span> <span class="s2">&quot;REDACTED&quot;</span><span class="p">,</span>
            <span class="s2">&quot;prefix&quot;</span><span class="p">:</span> <span class="s2">&quot;64&quot;</span><span class="p">,</span>
            <span class="s2">&quot;scope&quot;</span><span class="p">:</span> <span class="s2">&quot;link&quot;</span>
        <span class="p">}</span>
    <span class="p">],</span>
    <span class="s2">&quot;macaddress&quot;</span><span class="p">:</span> <span class="s2">&quot;REDACTED&quot;</span><span class="p">,</span>
    <span class="s2">&quot;module&quot;</span><span class="p">:</span> <span class="s2">&quot;e1000&quot;</span><span class="p">,</span>
    <span class="s2">&quot;mtu&quot;</span><span class="p">:</span> <span class="mi">1500</span><span class="p">,</span>
    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ether&quot;</span>
<span class="p">},</span>
<span class="s2">&quot;ansible_form_factor&quot;</span><span class="p">:</span> <span class="s2">&quot;Other&quot;</span><span class="p">,</span>
<span class="s2">&quot;ansible_fqdn&quot;</span><span class="p">:</span> <span class="s2">&quot;ubuntu2.example.com&quot;</span><span class="p">,</span>
<span class="s2">&quot;ansible_hostname&quot;</span><span class="p">:</span> <span class="s2">&quot;ubuntu2&quot;</span><span class="p">,</span>
<span class="s2">&quot;ansible_interfaces&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="s2">&quot;lo&quot;</span><span class="p">,</span>
    <span class="s2">&quot;eth0&quot;</span>
<span class="p">],</span>
<span class="s2">&quot;ansible_kernel&quot;</span><span class="p">:</span> <span class="s2">&quot;3.5.0-23-generic&quot;</span><span class="p">,</span>
<span class="s2">&quot;ansible_lo&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;active&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>
    <span class="s2">&quot;device&quot;</span><span class="p">:</span> <span class="s2">&quot;lo&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ipv4&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;address&quot;</span><span class="p">:</span> <span class="s2">&quot;127.0.0.1&quot;</span><span class="p">,</span>
        <span class="s2">&quot;netmask&quot;</span><span class="p">:</span> <span class="s2">&quot;255.0.0.0&quot;</span><span class="p">,</span>
        <span class="s2">&quot;network&quot;</span><span class="p">:</span> <span class="s2">&quot;127.0.0.0&quot;</span>
    <span class="p">},</span>
    <span class="s2">&quot;ipv6&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;address&quot;</span><span class="p">:</span> <span class="s2">&quot;::1&quot;</span><span class="p">,</span>
            <span class="s2">&quot;prefix&quot;</span><span class="p">:</span> <span class="s2">&quot;128&quot;</span><span class="p">,</span>
            <span class="s2">&quot;scope&quot;</span><span class="p">:</span> <span class="s2">&quot;host&quot;</span>
        <span class="p">}</span>
    <span class="p">],</span>
    <span class="s2">&quot;mtu&quot;</span><span class="p">:</span> <span class="mi">16436</span><span class="p">,</span>
    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;loopback&quot;</span>
<span class="p">},</span>
<span class="s2">&quot;ansible_lsb&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;codename&quot;</span><span class="p">:</span> <span class="s2">&quot;precise&quot;</span><span class="p">,</span>
    <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Ubuntu 12.04.2 LTS&quot;</span><span class="p">,</span>
    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;Ubuntu&quot;</span><span class="p">,</span>
    <span class="s2">&quot;major_release&quot;</span><span class="p">:</span> <span class="s2">&quot;12&quot;</span><span class="p">,</span>
    <span class="s2">&quot;release&quot;</span><span class="p">:</span> <span class="s2">&quot;12.04&quot;</span>
<span class="p">},</span>
<span class="s2">&quot;ansible_machine&quot;</span><span class="p">:</span> <span class="s2">&quot;x86_64&quot;</span><span class="p">,</span>
<span class="s2">&quot;ansible_memfree_mb&quot;</span><span class="p">:</span> <span class="mi">74</span><span class="p">,</span>
<span class="s2">&quot;ansible_memtotal_mb&quot;</span><span class="p">:</span> <span class="mi">991</span><span class="p">,</span>
<span class="s2">&quot;ansible_mounts&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s2">&quot;device&quot;</span><span class="p">:</span> <span class="s2">&quot;/dev/sda1&quot;</span><span class="p">,</span>
        <span class="s2">&quot;fstype&quot;</span><span class="p">:</span> <span class="s2">&quot;ext4&quot;</span><span class="p">,</span>
        <span class="s2">&quot;mount&quot;</span><span class="p">:</span> <span class="s2">&quot;/&quot;</span><span class="p">,</span>
        <span class="s2">&quot;options&quot;</span><span class="p">:</span> <span class="s2">&quot;rw,errors=remount-ro&quot;</span><span class="p">,</span>
        <span class="s2">&quot;size_available&quot;</span><span class="p">:</span> <span class="mi">15032406016</span><span class="p">,</span>
        <span class="s2">&quot;size_total&quot;</span><span class="p">:</span> <span class="mi">20079898624</span>
    <span class="p">}</span>
<span class="p">],</span>
<span class="s2">&quot;ansible_nodename&quot;</span><span class="p">:</span> <span class="s2">&quot;ubuntu2.example.com&quot;</span><span class="p">,</span>
<span class="s2">&quot;ansible_os_family&quot;</span><span class="p">:</span> <span class="s2">&quot;Debian&quot;</span><span class="p">,</span>
<span class="s2">&quot;ansible_pkg_mgr&quot;</span><span class="p">:</span> <span class="s2">&quot;apt&quot;</span><span class="p">,</span>
<span class="s2">&quot;ansible_processor&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="s2">&quot;Intel(R) Core(TM) i7 CPU         860  @ 2.80GHz&quot;</span>
<span class="p">],</span>
<span class="s2">&quot;ansible_processor_cores&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
<span class="s2">&quot;ansible_processor_count&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
<span class="s2">&quot;ansible_processor_threads_per_core&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
<span class="s2">&quot;ansible_processor_vcpus&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
<span class="s2">&quot;ansible_product_name&quot;</span><span class="p">:</span> <span class="s2">&quot;VMware Virtual Platform&quot;</span><span class="p">,</span>
<span class="s2">&quot;ansible_product_serial&quot;</span><span class="p">:</span> <span class="s2">&quot;REDACTED&quot;</span><span class="p">,</span>
<span class="s2">&quot;ansible_product_uuid&quot;</span><span class="p">:</span> <span class="s2">&quot;REDACTED&quot;</span><span class="p">,</span>
<span class="s2">&quot;ansible_product_version&quot;</span><span class="p">:</span> <span class="s2">&quot;None&quot;</span><span class="p">,</span>
<span class="s2">&quot;ansible_python_version&quot;</span><span class="p">:</span> <span class="s2">&quot;2.7.3&quot;</span><span class="p">,</span>
<span class="s2">&quot;ansible_selinux&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span>
<span class="s2">&quot;ansible_ssh_host_key_dsa_public&quot;</span><span class="p">:</span> <span class="s2">&quot;REDACTED KEY VALUE&quot;</span>
<span class="s2">&quot;ansible_ssh_host_key_ecdsa_public&quot;</span><span class="p">:</span> <span class="s2">&quot;REDACTED KEY VALUE&quot;</span>
<span class="s2">&quot;ansible_ssh_host_key_rsa_public&quot;</span><span class="p">:</span> <span class="s2">&quot;REDACTED KEY VALUE&quot;</span>
<span class="s2">&quot;ansible_swapfree_mb&quot;</span><span class="p">:</span> <span class="mi">665</span><span class="p">,</span>
<span class="s2">&quot;ansible_swaptotal_mb&quot;</span><span class="p">:</span> <span class="mi">1021</span><span class="p">,</span>
<span class="s2">&quot;ansible_system&quot;</span><span class="p">:</span> <span class="s2">&quot;Linux&quot;</span><span class="p">,</span>
<span class="s2">&quot;ansible_system_vendor&quot;</span><span class="p">:</span> <span class="s2">&quot;VMware, Inc.&quot;</span><span class="p">,</span>
<span class="s2">&quot;ansible_user_id&quot;</span><span class="p">:</span> <span class="s2">&quot;root&quot;</span><span class="p">,</span>
<span class="s2">&quot;ansible_userspace_architecture&quot;</span><span class="p">:</span> <span class="s2">&quot;x86_64&quot;</span><span class="p">,</span>
<span class="s2">&quot;ansible_userspace_bits&quot;</span><span class="p">:</span> <span class="s2">&quot;64&quot;</span><span class="p">,</span>
<span class="s2">&quot;ansible_virtualization_role&quot;</span><span class="p">:</span> <span class="s2">&quot;guest&quot;</span><span class="p">,</span>
<span class="s2">&quot;ansible_virtualization_type&quot;</span><span class="p">:</span> <span class="s2">&quot;VMware&quot;</span>
</pre></div>
</div>
<p>可以在playbook中这样引用以上例子中第一个硬盘的模型:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{{</span> <span class="n">ansible_devices</span><span class="o">.</span><span class="n">sda</span><span class="o">.</span><span class="n">model</span> <span class="p">}}</span>
</pre></div>
</div>
<p>同样,作为系统报告的主机名如以下所示:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{{</span> <span class="n">ansible_nodename</span> <span class="p">}}</span>
</pre></div>
</div>
<p>不合格的主机名显示了句号(.)之前的字符串:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{{</span> <span class="n">ansible_hostname</span> <span class="p">}}</span>
</pre></div>
</div>
<p>在模板和条件判断(请看 <span class="xref std std-doc">playbook_conditionals</span> )中会经常使用Facts.</p>
<p>还可以使用Facts根据特定的条件动态创建主机群组,请查看 <a class="reference internal" href="modules.html"><span class="doc">模块相关</span></a> 文档中的 ‘group_by’ 小节获取详细内容.以及参见 <a class="reference internal" href="playbooks_conditionals.html"><span class="doc">条件选择</span></a> 章节讨论的广义条件语句部分.</p>
</section>
<section id="facts-1">
<span id="disabling-facts"></span><h2><a class="toc-backref" href="#toc-entry-10" role="doc-backlink">关闭Facts</a><a class="headerlink" href="#facts-1" title="Permalink to this headline">¶</a></h2>
<p>如果你不需要使用你主机的任何fact数据,你已经知道了你系统的一切,那么你可以关闭fact数据的获取.这有利于增强Ansilbe面对大量系统的push模块,或者你在实验性平台中使用Ansible.在任何playbook中可以这样做:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span> <span class="n">hosts</span><span class="p">:</span> <span class="n">whatever</span>
  <span class="n">gather_facts</span><span class="p">:</span> <span class="n">no</span>
</pre></div>
</div>
</section>
<section id="facts-facts-d">
<span id="local-facts"></span><h2><a class="toc-backref" href="#toc-entry-11" role="doc-backlink">本地Facts(Facts.d)</a><a class="headerlink" href="#facts-facts-d" title="Permalink to this headline">¶</a></h2>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.3.</span></p>
</div>
<p>正如在playbook章节讨论的一样,Ansible facts主要用于获取远程系统的数据,从而可以在playbook中作为变量使用.</p>
<p>通常facts中的数据是由Ansible中的 ‘setup’模块自动发现的.用户也可以自定义facts模块,在API文档中有说明.然而,如果不借助于fact模块,而是通过一个简单的方式为Ansible变量提供系统或用户数据？</p>
<p>比如,你想用户能够控制受他们管理的系统的一些切面,那么应该怎么做？ “Facts.d”是这样的一种机制.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>可能 “局部facts”有点用词不当,它与 “中心供应的用户值”相对应,为”局部供应的用户值”,或者facts是 “局部动态测定的值”.</p>
</aside>
<p>如果远程受管理的机器有一个 “/etc/ansible/facts.d” 目录,那么在该目录中任何以 “.fact”结尾的文件都可以在Ansible中提供局部facts.这些文件可以是JSON,INI或者任何可以返回JSON的可执行文件.</p>
<p>例如建设有一个 /etc/ansible/facts.d/perferences.fact文件:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">general</span><span class="p">]</span>
<span class="n">asdf</span><span class="o">=</span><span class="mi">1</span>
<span class="n">bar</span><span class="o">=</span><span class="mi">2</span>
</pre></div>
</div>
<p>这将产生一个名为 “general” 的哈希表fact,里面成员有 ‘asdf’ 和 ‘bar’.
可以这样验证:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ansible</span> <span class="o">&lt;</span><span class="n">hostname</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">m</span> <span class="n">setup</span> <span class="o">-</span><span class="n">a</span> <span class="s2">&quot;filter=ansible_local&quot;</span>
</pre></div>
</div>
<p>然后你会看到有以下fact被添加:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;ansible_local&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;preferences&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;general&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;asdf&quot;</span> <span class="p">:</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span>
                <span class="s2">&quot;bar&quot;</span>  <span class="p">:</span> <span class="s2">&quot;2&quot;</span>
            <span class="p">}</span>
        <span class="p">}</span>
 <span class="p">}</span>
</pre></div>
</div>
<p>而且也可以在template或palybook中访问该数据:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{{</span> <span class="n">ansible_local</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">general</span><span class="o">.</span><span class="n">asdf</span> <span class="p">}}</span>
</pre></div>
</div>
<p>本地命名空间放置其它用户提供的fact或者playbook中定义的变量覆盖系统facts值.</p>
<p>如果你有个一个playook,它复制了一个自定义的fact,然后运行它,请显式调用来重新运行setup模块,这样可以让我们在该playbook中使用这些fact.否则,在下一个play中才能获取这些自定义的fact信息.这里有一个示例:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span> <span class="n">hosts</span><span class="p">:</span> <span class="n">webservers</span>
  <span class="n">tasks</span><span class="p">:</span>
    <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">create</span> <span class="n">directory</span> <span class="k">for</span> <span class="n">ansible</span> <span class="n">custom</span> <span class="n">facts</span>
      <span class="n">file</span><span class="p">:</span> <span class="n">state</span><span class="o">=</span><span class="n">directory</span> <span class="n">recurse</span><span class="o">=</span><span class="n">yes</span> <span class="n">path</span><span class="o">=/</span><span class="n">etc</span><span class="o">/</span><span class="n">ansible</span><span class="o">/</span><span class="n">facts</span><span class="o">.</span><span class="n">d</span>
    <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">install</span> <span class="n">custom</span> <span class="n">impi</span> <span class="n">fact</span>
      <span class="n">copy</span><span class="p">:</span> <span class="n">src</span><span class="o">=</span><span class="n">ipmi</span><span class="o">.</span><span class="n">fact</span> <span class="n">dest</span><span class="o">=/</span><span class="n">etc</span><span class="o">/</span><span class="n">ansible</span><span class="o">/</span><span class="n">facts</span><span class="o">.</span><span class="n">d</span>
    <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">re</span><span class="o">-</span><span class="n">read</span> <span class="n">facts</span> <span class="n">after</span> <span class="n">adding</span> <span class="n">custom</span> <span class="n">fact</span>
      <span class="n">setup</span><span class="p">:</span> <span class="nb">filter</span><span class="o">=</span><span class="n">ansible_local</span>
</pre></div>
</div>
<p>然而在该模式中你也可以编写一个fact模块,这只不过是多了一个选项.</p>
</section>
<section id="fact">
<span id="fact-caching"></span><h2><a class="toc-backref" href="#toc-entry-12" role="doc-backlink">Fact缓存</a><a class="headerlink" href="#fact" title="Permalink to this headline">¶</a></h2>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.8.</span></p>
</div>
<p>正如该文档中其它地方所示,从一个服务器引用另一个服务器的变量是可行的.比如:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{{</span> <span class="n">hostvars</span><span class="p">[</span><span class="s1">&#39;asdf.example.com&#39;</span><span class="p">][</span><span class="s1">&#39;ansible_os_family&#39;</span><span class="p">]</span> <span class="p">}}</span>
</pre></div>
</div>
<p>如果禁用 “Fact Caching”,为了实现以上功能,Ansible在当前play之前已经与 ‘asdf.example.com’ 通讯过,或者在playbook有其它优先的play.这是ansible的默认配置.</p>
<p>为了避免这些,Ansible 1.8允许在playbook运行期间保存facts.但该功能需要手动开启.这有什么用处那？</p>
<p>想象一下,如果我们有一个非常大的基础设施,里面有数千个主机.Fact缓存可以配置在夜间运行,但小型服务器集群可以配置fact随时运行,或者在白天定期运行.即使开启了fact缓存,也不需要访问所有服务器来引用它们的变量和信息.</p>
<p>使用fact缓存可以跨群组访问变量,即使群组间在当前/user/bin/ansible-playbook执行中并没有通讯过.</p>
<p>为了启用fact缓存,在大多数plays中你可以修改 ‘gathering’ 设置为 ‘smart’ 或者 ‘explicit’,也可以设置 ‘gather_facts’ 为False.</p>
<p>当前,Ansible可以使用两种持久的缓存插件: redis和jsonfile.</p>
<p>可以在ansible.cfg中配置fact缓存使用redis:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">defaults</span><span class="p">]</span>
<span class="n">gathering</span> <span class="o">=</span> <span class="n">smart</span>
<span class="n">fact_caching</span> <span class="o">=</span> <span class="n">redis</span>
<span class="n">fact_caching_timeout</span> <span class="o">=</span> <span class="mi">86400</span>
<span class="c1"># seconds</span>
</pre></div>
</div>
<p>请执行适当的系统命令来启动和运行redis:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">yum</span> <span class="n">install</span> <span class="n">redis</span>
<span class="n">service</span> <span class="n">redis</span> <span class="n">start</span>
<span class="n">pip</span> <span class="n">install</span> <span class="n">redis</span>
</pre></div>
</div>
<p>请注意可以使用pip来安装Python redis库,在EPEL中的包版本对Ansible来说太旧了.
在当前Ansible版本中,该功能还处于试用状态,Redis插件还不支持端口或密码配置,以后会改善这点.
在ansible.cfg中使用以下代码来配置fact缓存使用jsonfile:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">defaults</span><span class="p">]</span>
<span class="n">gathering</span> <span class="o">=</span> <span class="n">smart</span>
<span class="n">fact_caching</span> <span class="o">=</span> <span class="n">jsonfile</span>
<span class="n">fact_caching_connection</span> <span class="o">=</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">cachedir</span>
<span class="n">fact_caching_timeout</span> <span class="o">=</span> <span class="mi">86400</span>
<span class="c1"># seconds</span>
</pre></div>
</div>
<p><cite>fact_caching_connection</cite> 是一个放置在可读目录(如果目录不存在,ansible会试图创建它)中的本地文件路径.</p>
</section>
<section id="section-2">
<span id="registered-variables"></span><h2><a class="toc-backref" href="#toc-entry-13" role="doc-backlink">注册变量</a><a class="headerlink" href="#section-2" title="Permalink to this headline">¶</a></h2>
<p>变量的另一个主要用途是在运行命令时,把命令结果存储到一个变量中.不同模块的执行结果是不同的.运行playbook时使用-v选项可以看到可能的结果值.
在ansible执行任务的结果值可以保存在变量中,以便稍后使用它.在 <a class="reference internal" href="playbooks_conditionals.html"><span class="doc">条件选择</span></a> 章节有一些示例.</p>
<p>这里有一个语法示例,在上面文档中也有所提及:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span> <span class="n">hosts</span><span class="p">:</span> <span class="n">web_servers</span>

  <span class="n">tasks</span><span class="p">:</span>

     <span class="o">-</span> <span class="n">shell</span><span class="p">:</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">foo</span>
       <span class="n">register</span><span class="p">:</span> <span class="n">foo_result</span>
       <span class="n">ignore_errors</span><span class="p">:</span> <span class="kc">True</span>

     <span class="o">-</span> <span class="n">shell</span><span class="p">:</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">bar</span>
       <span class="n">when</span><span class="p">:</span> <span class="n">foo_result</span><span class="o">.</span><span class="n">rc</span> <span class="o">==</span> <span class="mi">5</span>
</pre></div>
</div>
<p>在当前主机接下来playbook运行过程中注册的变量是有效地.这与Ansile中的 “facts” 生命周期一样. 实际上注册变量和facts很相似.</p>
</section>
<section id="section-3">
<span id="accessing-complex-variable-data"></span><h2><a class="toc-backref" href="#toc-entry-14" role="doc-backlink">访问复杂变量数据</a><a class="headerlink" href="#section-3" title="Permalink to this headline">¶</a></h2>
<p>在该文档中我们已经讨论了一些与facts有关的高级特性.</p>
<p>有些提供的facts,比如网络信息等,是一个嵌套的数据结构.访问它们使用简单的 {{ foo }} 语法并不够用,当仍然很容易.如下所示:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{{</span> <span class="n">ansible_eth0</span><span class="p">[</span><span class="s2">&quot;ipv4&quot;</span><span class="p">][</span><span class="s2">&quot;address&quot;</span><span class="p">]</span> <span class="p">}}</span>
</pre></div>
</div>
<p>或者这样写:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{{</span> <span class="n">ansible_eth0</span><span class="o">.</span><span class="n">ipv4</span><span class="o">.</span><span class="n">address</span> <span class="p">}}</span>
</pre></div>
</div>
<p>相似的,以下代码展示了我们如何访问数组的第一个元素:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{{</span> <span class="n">foo</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">}}</span>
</pre></div>
</div>
</section>
<section id="section-4">
<span id="magic-variables-and-hostvars"></span><h2><a class="toc-backref" href="#toc-entry-15" role="doc-backlink">魔法变量,以及如何访问其它主机的信息</a><a class="headerlink" href="#section-4" title="Permalink to this headline">¶</a></h2>
<p>Ansible会自动提供给你一些变量,即使你并没有定义过它们.这些变量中重要的有 ‘hostvars’,’group_names’,和 ‘groups’.由于这些变量名是预留的,所以用户不应当覆盖它们. ‘environmen’ 也是预留的.
hostvars可以让你访问其它主机的变量,包括哪些主机中获取到的facts.如果你还没有在当前playbook或者一组playbook的任何play中访问那个主机,那么你可以获取变量,但无法看到facts值.
如果数据库服务器想使用另一个节点的某个 ‘fact’ 值,或者赋值给该节点的一个inventory变量.可以在一个模板中甚至命令行中轻松实现:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{{</span> <span class="n">hostvars</span><span class="p">[</span><span class="s1">&#39;test.example.com&#39;</span><span class="p">][</span><span class="s1">&#39;ansible_distribution&#39;</span><span class="p">]</span> <span class="p">}}</span>
</pre></div>
</div>
<p>另外, <em>group_names</em> 是当前主机所在所有群组的列表(数组).所以可以使用Jinja2语法在模板中根据该主机所在群组关系(或角色)来产生变化:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="o">%</span> <span class="k">if</span> <span class="s1">&#39;webserver&#39;</span> <span class="ow">in</span> <span class="n">group_names</span> <span class="o">%</span><span class="p">}</span>
   <span class="c1"># some part of a configuration file that only applies to webservers</span>
<span class="p">{</span><span class="o">%</span> <span class="n">endif</span> <span class="o">%</span><span class="p">}</span>
</pre></div>
</div>
<p><em>groups</em> 是inventory中所有群组(主机)的列表.可用于枚举群组中的所有主机.例如:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="o">%</span> <span class="k">for</span> <span class="n">host</span> <span class="ow">in</span> <span class="n">groups</span><span class="p">[</span><span class="s1">&#39;app_servers&#39;</span><span class="p">]</span> <span class="o">%</span><span class="p">}</span>
   <span class="c1"># something that applies to all app servers.</span>
<span class="p">{</span><span class="o">%</span> <span class="n">endfor</span> <span class="o">%</span><span class="p">}</span>
</pre></div>
</div>
<p>一个经常使用的范式是找出该群组中的所有IP地址:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="o">%</span> <span class="k">for</span> <span class="n">host</span> <span class="ow">in</span> <span class="n">groups</span><span class="p">[</span><span class="s1">&#39;app_servers&#39;</span><span class="p">]</span> <span class="o">%</span><span class="p">}</span>
   <span class="p">{{</span> <span class="n">hostvars</span><span class="p">[</span><span class="n">host</span><span class="p">][</span><span class="s1">&#39;ansible_eth0&#39;</span><span class="p">][</span><span class="s1">&#39;ipv4&#39;</span><span class="p">][</span><span class="s1">&#39;address&#39;</span><span class="p">]</span> <span class="p">}}</span>
<span class="p">{</span><span class="o">%</span> <span class="n">endfor</span> <span class="o">%</span><span class="p">}</span>
</pre></div>
</div>
<p>比如,一个前端代理服务器需要指向所有的应用服务器,在服务器间设置正确的防火墙规则等.你需要确保所有主机的facts在使用前都已被获取到,例如运行一个play来检查这些facts是否已经被缓存起来(fact缓存是Ansible 1.8中的新特性).</p>
<p>另外, <em>inventory_hostname</em> 是Ansible inventory主机文件中配置的主机名称.由于其它一些神秘原因你不想使用自发现的主机名 <cite>ansible_hostname</cite> 时,你可以使用 <em>inventory_hostname</em> .如果主机的FQDN很长,那么*inventory_hostname_short*则会只包含域名第一个分号之前的部分,而舍弃其它部分.</p>
<p><em>play_hosts</em> 是在当前play范围中可用的一组主机名.比如可以为多个主机填写模板,以便将这些主机注入负载均衡器规则.</p>
<p><em>delegate_to</em> is the inventory hostname of the host that the current task has been delegated to using ‘delegate_to’.</p>
<p><em>delegate_to</em> 是使用 ‘delegate_to’ 代理的任务中主机的inventory主机名.</p>
<p>不要担心以上东西,除非你需要使用它们.你会知道什么时候用它们.</p>
<p><em>inventory_dir</em> 是保存Ansible inventory主机文件的目录路径, <em>inventory_file</em> 是指向Ansible inventory主机文件的路径和文件名.</p>
<p>最后, <em>role_path</em> 会返回当前role的目录名(1.8及以后).只有在role中才能使用该变量.</p>
</section>
<section id="section-5">
<span id="variable-file-separation-details"></span><h2><a class="toc-backref" href="#toc-entry-16" role="doc-backlink">变量文件分割</a><a class="headerlink" href="#section-5" title="Permalink to this headline">¶</a></h2>
<p>把playbook置于源代码管理之下是个很好的注意,当你可能会想把playbook源码公开之余还想保持某些重要的变量私有.有时你也想把某些信息放置在不同的文件中,远离主playbook文件.</p>
<p>你可以使用外部的变量文件来实现:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">---</span>

<span class="o">-</span> <span class="n">hosts</span><span class="p">:</span> <span class="nb">all</span>
  <span class="n">remote_user</span><span class="p">:</span> <span class="n">root</span>
  <span class="nb">vars</span><span class="p">:</span>
    <span class="n">favcolor</span><span class="p">:</span> <span class="n">blue</span>
  <span class="n">vars_files</span><span class="p">:</span>
    <span class="o">-</span> <span class="o">/</span><span class="nb">vars</span><span class="o">/</span><span class="n">external_vars</span><span class="o">.</span><span class="n">yml</span>

  <span class="n">tasks</span><span class="p">:</span>

  <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">this</span> <span class="ow">is</span> <span class="n">just</span> <span class="n">a</span> <span class="n">placeholder</span>
    <span class="n">command</span><span class="p">:</span> <span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">echo</span> <span class="n">foo</span>
</pre></div>
</div>
<p>这可以保证你共享playbook源码时隔离敏感数据的风险.</p>
<p>每个变量文件的内容是一个简单的YAML文件,如下所示:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">---</span>
<span class="c1"># in the above example, this would be vars/external_vars.yml</span>
<span class="n">somevar</span><span class="p">:</span> <span class="n">somevalue</span>
<span class="n">password</span><span class="p">:</span> <span class="n">magic</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It’s also possible to keep per-host and per-group variables in very
similar files, this is covered in <a class="reference internal" href="intro_inventory.html#splitting-out-vars"><span class="std std-ref">分文件定义 Host 和 Group 变量</span></a>.</p>
</aside>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>保持每个主机和群组的变量在非常小的文件中是可能,请参见 <a class="reference internal" href="intro_inventory.html#splitting-out-vars"><span class="std std-ref">分文件定义 Host 和 Group 变量</span></a>.</p>
</aside>
</section>
<section id="section-6">
<span id="passing-variables-on-the-command-line"></span><h2><a class="toc-backref" href="#toc-entry-17" role="doc-backlink">命令行中传递变量</a><a class="headerlink" href="#section-6" title="Permalink to this headline">¶</a></h2>
<p>除了`vars_prompt`和`vars_files`也可以通过Ansible命令行发送变量.如果你想编写一个通用的发布playbook时则特别有用,你可以传递应用的版本以便部署:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ansible</span><span class="o">-</span><span class="n">playbook</span> <span class="n">release</span><span class="o">.</span><span class="n">yml</span> <span class="o">--</span><span class="n">extra</span><span class="o">-</span><span class="nb">vars</span> <span class="s2">&quot;version=1.23.45 other_variable=foo&quot;</span>
</pre></div>
</div>
<p>其它场景中也很有用,比如为playbook设置主机群组或用户.</p>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">---</span>

<span class="o">-</span> <span class="n">hosts</span><span class="p">:</span> <span class="s1">&#39;{{ hosts }}&#39;</span>
  <span class="n">remote_user</span><span class="p">:</span> <span class="s1">&#39;{{ user }}&#39;</span>

  <span class="n">tasks</span><span class="p">:</span>
     <span class="o">-</span> <span class="o">...</span>

<span class="n">ansible</span><span class="o">-</span><span class="n">playbook</span> <span class="n">release</span><span class="o">.</span><span class="n">yml</span> <span class="o">--</span><span class="n">extra</span><span class="o">-</span><span class="nb">vars</span> <span class="s2">&quot;hosts=vipers user=starbuck&quot;</span>
</pre></div>
</div>
<p>Ansible 1.2中你也可以给extra-vars传递JSON,比如:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">--</span><span class="n">extra</span><span class="o">-</span><span class="nb">vars</span> <span class="s1">&#39;{&quot;pacman&quot;:&quot;mrs&quot;,&quot;ghosts&quot;:[&quot;inky&quot;,&quot;pinky&quot;,&quot;clyde&quot;,&quot;sue&quot;]}&#39;</span>
</pre></div>
</div>
<p>key=value形式非常简单,但很实用!</p>
<p>Ansible 1.3中,实用”&#64;”语法可以为extra-vars传递JSON文件:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">--</span><span class="n">extra</span><span class="o">-</span><span class="nb">vars</span> <span class="s2">&quot;@some_file.json&quot;</span>
</pre></div>
</div>
<p>同样在Ansible 1.3中,我们可以为extra-vars传递YAML格式,无论直接通过命令行还是放置在文件中.</p>
</section>
<section id="section-7">
<span id="variable-precedence"></span><h2><a class="toc-backref" href="#toc-entry-18" role="doc-backlink">变量的优先级: 我该在什么地方放置变量?</a><a class="headerlink" href="#section-7" title="Permalink to this headline">¶</a></h2>
<p>很多人都在问变量重载的规则是怎么样的.最终Ansible的哲学是你最好知道哪里放置变量,然后会简化变量覆盖的复杂度.</p>
<p>避免在47个地方定义 “x” 变量然后询问 “那个x会被使用”. 为什么那？ 因为这不是Ansible做事的哲学.</p>
<p>世界上只有一个帝国大厦.也只有一个蒙娜丽莎.请弄明白在那里定义变量,而不要把事情搞复杂.</p>
<p>然而,我们还是来讨卵一下优先权的问题.它存在.你有可能会用到它.</p>
<p>如果同样名称的变量在多个地方都有定义,那么采纳是有个确定的顺序,如下:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">*</span> <span class="n">extra</span> <span class="nb">vars</span> <span class="p">(</span><span class="o">-</span><span class="n">e</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">command</span> <span class="n">line</span><span class="p">)</span> <span class="n">always</span> <span class="n">win</span>
<span class="o">*</span> <span class="n">then</span> <span class="n">comes</span> <span class="n">connection</span> <span class="n">variables</span> <span class="n">defined</span> <span class="ow">in</span> <span class="n">inventory</span> <span class="p">(</span><span class="n">ansible_ssh_user</span><span class="p">,</span> <span class="n">etc</span><span class="p">)</span>
<span class="o">*</span> <span class="n">then</span> <span class="n">comes</span> <span class="s2">&quot;most everything else&quot;</span> <span class="p">(</span><span class="n">command</span> <span class="n">line</span> <span class="n">switches</span><span class="p">,</span> <span class="nb">vars</span> <span class="ow">in</span> <span class="n">play</span><span class="p">,</span> <span class="n">included</span> <span class="nb">vars</span><span class="p">,</span> <span class="n">role</span> <span class="nb">vars</span><span class="p">,</span> <span class="n">etc</span><span class="p">)</span>
<span class="o">*</span> <span class="n">then</span> <span class="n">comes</span> <span class="n">the</span> <span class="n">rest</span> <span class="n">of</span> <span class="n">the</span> <span class="n">variables</span> <span class="n">defined</span> <span class="ow">in</span> <span class="n">inventory</span>
<span class="o">*</span> <span class="n">then</span> <span class="n">comes</span> <span class="n">facts</span> <span class="n">discovered</span> <span class="n">about</span> <span class="n">a</span> <span class="n">system</span>
<span class="o">*</span> <span class="n">then</span> <span class="s2">&quot;role defaults&quot;</span><span class="p">,</span> <span class="n">which</span> <span class="n">are</span> <span class="n">the</span> <span class="n">most</span> <span class="s2">&quot;defaulty&quot;</span> <span class="ow">and</span> <span class="n">lose</span> <span class="ow">in</span> <span class="n">priority</span> <span class="n">to</span> <span class="n">everything</span><span class="o">.</span>

<span class="o">*</span> <span class="n">extra</span> <span class="nb">vars</span> <span class="p">(</span><span class="n">在命令行中使用</span> <span class="o">-</span><span class="n">e</span><span class="p">)</span><span class="n">优先级最高</span>
<span class="o">*</span> <span class="n">然后是在inventory中定义的连接变量</span><span class="p">(</span><span class="n">比如ansible_ssh_user</span><span class="p">)</span>
<span class="o">*</span> <span class="n">接着是大多数的其它变量</span><span class="p">(</span><span class="n">命令行转换</span><span class="p">,</span><span class="n">play中的变量</span><span class="p">,</span><span class="n">included的变量</span><span class="p">,</span><span class="n">role中的变量等</span><span class="p">)</span>
<span class="o">*</span> <span class="n">然后是在inventory定义的其它变量</span>
<span class="o">*</span> <span class="n">然后是由系统发现的facts</span>
<span class="o">*</span> <span class="n">然后是</span> <span class="s2">&quot;role默认变量&quot;</span><span class="p">,</span> <span class="n">这个是最默认的值</span><span class="p">,</span><span class="n">很容易丧失优先权</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In versions prior to 1.5.4, facts discovered about a system were in the “most everything else” category above.</p>
</aside>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>在1.5.4版本级以后,关于系统的自发现的facts也包含在大多数的其它变量中.</p>
</aside>
<p>这样看起来太理论化了.让我们来看一段示例,</p>
<p>First off, group variables are super powerful.</p>
<p>Site wide defaults should be defined as a ‘group_vars/all’ setting.  Group variables are generally placed alongside
your inventory file.  They can also be returned by a dynamic inventory script (see <a class="reference internal" href="intro_dynamic_inventory.html"><span class="doc">动态 Inventory</span></a>) or defined
in things like <a class="reference internal" href="tower.html"><span class="doc">Ansible Tower</span></a> from the UI or API:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">---</span>
<span class="c1"># file: /etc/ansible/group_vars/all</span>
<span class="c1"># this is the site wide default</span>
<span class="n">ntp_server</span><span class="p">:</span> <span class="n">default</span><span class="o">-</span><span class="n">time</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span>
</pre></div>
</div>
<p>Regional information might be defined in a ‘group_vars/region’ variable.  If this group is a child of the ‘all’ group (which it is, because all groups are), it will override the group that is higher up and more general:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">---</span>
<span class="c1"># file: /etc/ansible/group_vars/boston</span>
<span class="n">ntp_server</span><span class="p">:</span> <span class="n">boston</span><span class="o">-</span><span class="n">time</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span>
</pre></div>
</div>
<p>If for some crazy reason we wanted to tell just a specific host to use a specific NTP server, it would then override the group variable!:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">---</span>
<span class="c1"># file: /etc/ansible/host_vars/xyz.boston.example.com</span>
<span class="n">ntp_server</span><span class="p">:</span> <span class="n">override</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span>
</pre></div>
</div>
<p>So that covers inventory and what you would normally set there.  It’s a great place for things that deal with geography or behavior.  Since groups are frequently the entity that maps roles onto hosts, it is sometimes a shortcut to set variables on the group instead of defining them on a role.  You could go either way.</p>
<p>Remember:  Child groups override parent groups, and hosts always override their groups.</p>
<p>Next up: learning about role variable precedence.</p>
<p>We’ll pretty much assume you are using roles at this point.  You should be using roles for sure.  Roles are great.  You are using
roles aren’t you?  Hint hint.</p>
<p>Ok, so if you are writing a redistributable role with reasonable defaults, put those in the ‘roles/x/defaults/main.yml’ file.  This means
the role will bring along a default value but ANYTHING in Ansible will override it.  It’s just a default.  That’s why it says “defaults” :)
See <a class="reference internal" href="playbooks_roles.html"><span class="doc">Playbook 角色(Roles) 和 Include 语句</span></a> for more info about this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">---</span>
<span class="c1"># file: roles/x/defaults/main.yml</span>
<span class="c1"># if not overridden in inventory or as a parameter, this is the value that will be used</span>
<span class="n">http_port</span><span class="p">:</span> <span class="mi">80</span>
</pre></div>
</div>
<p>if you are writing a role and want to ensure the value in the role is absolutely used in that role, and is not going to be overridden
by inventory, you should put it in roles/x/vars/main.yml like so, and inventory values cannot override it.  -e however, still will:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">---</span>
<span class="c1"># file: roles/x/vars/main.yml</span>
<span class="c1"># this will absolutely be used in this role</span>
<span class="n">http_port</span><span class="p">:</span> <span class="mi">80</span>
</pre></div>
</div>
<p>So the above is a great way to plug in constants about the role that are always true.  If you are not sharing your role with others,
app specific behaviors like ports is fine to put in here.  But if you are sharing roles with others, putting variables in here might
be bad. Nobody will be able to override them with inventory, but they still can by passing a parameter to the role.</p>
<p>Parameterized roles are useful.</p>
<p>If you are using a role and want to override a default, pass it as a parameter to the role like so:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">roles</span><span class="p">:</span>
   <span class="o">-</span> <span class="p">{</span> <span class="n">role</span><span class="p">:</span> <span class="n">apache</span><span class="p">,</span> <span class="n">http_port</span><span class="p">:</span> <span class="mi">8080</span> <span class="p">}</span>
</pre></div>
</div>
<p>This makes it clear to the playbook reader that you’ve made a conscious choice to override some default in the role, or pass in some
configuration that the role can’t assume by itself.  It also allows you to pass something site-specific that isn’t really part of the
role you are sharing with others.</p>
<p>This can often be used for things that might apply to some hosts multiple times,
like so:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">roles</span><span class="p">:</span>
   <span class="o">-</span> <span class="p">{</span> <span class="n">role</span><span class="p">:</span> <span class="n">app_user</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="n">Ian</span>    <span class="p">}</span>
   <span class="o">-</span> <span class="p">{</span> <span class="n">role</span><span class="p">:</span> <span class="n">app_user</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="n">Terry</span>  <span class="p">}</span>
   <span class="o">-</span> <span class="p">{</span> <span class="n">role</span><span class="p">:</span> <span class="n">app_user</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="n">Graham</span> <span class="p">}</span>
   <span class="o">-</span> <span class="p">{</span> <span class="n">role</span><span class="p">:</span> <span class="n">app_user</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="n">John</span>   <span class="p">}</span>
</pre></div>
</div>
<p>That’s a bit arbitrary, but you can see how the same role was invoked multiple Times.  In that example it’s quite likely there was
no default for ‘name’ supplied at all.  Ansible can yell at you when variables aren’t defined – it’s the default behavior in fact.</p>
<p>So that’s a bit about roles.</p>
<p>There are a few bonus things that go on with roles.</p>
<p>Generally speaking, variables set in one role are available to others.  This means if you have a “roles/common/vars/main.yml” you
can set variables in there and make use of them in other roles and elsewhere in your playbook:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">roles</span><span class="p">:</span>
   <span class="o">-</span> <span class="p">{</span> <span class="n">role</span><span class="p">:</span> <span class="n">common_settings</span> <span class="p">}</span>
   <span class="o">-</span> <span class="p">{</span> <span class="n">role</span><span class="p">:</span> <span class="n">something</span><span class="p">,</span> <span class="n">foo</span><span class="p">:</span> <span class="mi">12</span> <span class="p">}</span>
   <span class="o">-</span> <span class="p">{</span> <span class="n">role</span><span class="p">:</span> <span class="n">something_else</span> <span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>There are some protections in place to avoid the need to namespace variables.
In the above, variables defined in common_settings are most definitely available to ‘something’ and ‘something_else’ tasks, but if
“something’s” guaranteed to have foo set at 12, even if somewhere deep in common settings it set foo to 20.</p>
</aside>
<p>So, that’s precedence, explained in a more direct way.  Don’t worry about precedence, just think about if your role is defining a
variable that is a default, or a “live” variable you definitely want to use.  Inventory lies in precedence right in the middle, and
if you want to forcibly override something, use -e.</p>
<p>If you found that a little hard to understand, take a look at the <a class="reference external" href="https://github.com/ansible/ansible-examples">ansible-examples</a> repo on our github for a bit more about
how all of these things can work together.</p>
<p>如果你还感觉有点难以理解,你可以学习我们放在github中的 <a class="reference external" href="https://github.com/ansible/ansible-examples">ansible-examples</a> 代码库,来了解这些东西是如何一起协作的.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<dl class="simple">
<dt><a class="reference internal" href="playbooks.html"><span class="doc">Playbooks</span></a></dt><dd><p>An introduction to playbooks</p>
</dd>
<dt><a class="reference internal" href="playbooks_conditionals.html"><span class="doc">条件选择</span></a></dt><dd><p>Conditional statements in playbooks</p>
</dd>
<dt><span class="xref std std-doc">playbooks_filters</span></dt><dd><p>Jinja2 filters and their uses</p>
</dd>
<dt><a class="reference internal" href="playbooks_loops.html"><span class="doc">循环</span></a></dt><dd><p>Looping in playbooks</p>
</dd>
<dt><a class="reference internal" href="playbooks_roles.html"><span class="doc">Playbook 角色(Roles) 和 Include 语句</span></a></dt><dd><p>Playbook organization by roles</p>
</dd>
<dt><a class="reference internal" href="playbooks_best_practices.html"><span class="doc">最佳实践</span></a></dt><dd><p>Best practices in playbooks</p>
</dd>
<dt><a class="reference external" href="http://groups.google.com/group/ansible-devel">User Mailing List</a></dt><dd><p>Have a question?  Stop by the google group!</p>
</dd>
<dt><a class="reference external" href="http://irc.freenode.net">irc.freenode.net</a></dt><dd><p>#ansible IRC chat channel</p>
</dd>
</dl>
</aside>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="playbooks_roles.html" class="btn btn-neutral float-left" title="Playbook 角色(Roles) 和 Include 语句" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="playbooks_conditionals.html" class="btn btn-neutral float-right" title="条件选择" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2015, http://www.magedu.com, 马哥Linux团队成员荣誉出品(薛定谔的章鱼 &amp; guli &amp; 以马内利 &amp; 黄博文 &amp; coocla &amp; 云中鹤 &amp; stanley) 官方QQ交流群:372011984.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>